(function(a,b){jQuery.fn.bgScroll=function(c){c=a.extend({},jQuery.fn.bgScroll.defaults,c);var d=function(d){var e=this;c.bodyChild&&d.appendTo("body"),d.css(c.containerCss);var f=d.data("img-src")?d.data("img-src"):c.image;a("<img/>").appendTo(d).hide().load(function(){e.$image=a(this),e.orgWidth=a(this).width(),e.orgHeight=a(this).height(),e.imageRatio=e.orgWidth/e.orgHeight,e.currentStep=c.startStep,e.minDiffBottom=c.steps*c.stepMinHeight,e.isAnimating=!1,e.update(),e.$image.fadeIn(),a(b).on("resize",a.proxy(e.update,e))}).attr("src",f).css("position","absolute"),d.on("bgscroll.next",a.proxy(this.next,this)),d.on("bgscroll.prev",a.proxy(this.prev,this)),d.on("bgscroll.step",a.proxy(this.step,this))};return d.prototype.prev=function(){if(this.currentStep<=1)return;this.gotoStep(this.currentStep-1)},d.prototype.next=function(){if(this.currentStep>=c.steps)return;this.gotoStep(this.currentStep+1)},d.prototype.step=function(a,b){this.gotoStep(b)},d.prototype.gotoStep=function(a){var b=this;if(typeof this.$image=="undefined")return;if(this.isAnimating)return;this.isAnimating=!0,this.$image.animate({top:a*this.currentStepDistance+"px"},c.animationTime,function(){b.isAnimating=!1}),this.currentStep=a},d.prototype.update=function(){if(this.isAnimating)return this;var d=a(b).width(),e=a(b).height(),f=d/this.orgWidth,g=(e+this.minDiffBottom)/this.orgHeight,h=f>g?f:g,i=h*this.orgWidth,j=h*this.orgHeight,k=e-j,l=k/c.steps;if(i>d){var m=d-i,n=m/2;this.$image.css({left:n})}else this.$image.css({left:0});return this.$image.css({top:l*(this.currentStep-1)+"px"}),this.$image.width(i),this.$image.height(j),this.currentStepDistance=l,this},this.each(function(){new d(a(this))})},jQuery.fn.bgScroll.defaults={image:"background.jpg",steps:3,startStep:1,stepMinHeight:50,bodyChild:!0,animationTime:800,containerCss:{width:"100%",height:"100%",top:"0",left:"0",position:"fixed",overflow:"hidden","z-index":"-1"}}})(jQuery,window);